{% extends 'base.html' %}

{% load advertising %}

{% block head_extras %}
<script type="text/javascript">
   $(document).ready(function() {
      $('#more_author_options').hide();
      $('a#more_authors').click(function() {
         $('a#more_authors').hide();
         $('a#collapse_authors').show('slow');
         $('#more_author_options').show('slow', function() {
//            $('a#collapse_authors').click(function() {
//               $('a#more_authors').show('slow'0);
//               $('a#collapse_authors').hide();
//               $('#more_author_options').hide();
//            });
         });
      });
   });
</script>
<style>
h3.selected a {
    color: #333333;
}
h3.selected a:hover {
    color: #999999;
}
</style>
{% endblock head_extras %}

{% block content_wide %}
    <form method="get" action=".">
    <div id="content" class="grid_9 alpha">
        <h2>Search</h2>
        <table>
            {{ form.as_table }}
            <tr>
                <td>&nbsp;</td>
                <td>
                    <input type="submit" value="Search">
                </td>
            </tr>
        </table>
        {% if spelling_suggestion %}<h3>Did you mean <a href="?q={{ literal_spelling_suggestion }}">{{ spelling_suggestion|capfirst }}</a>?</h3>{% endif %}
        {% if query %}
       	    <div class="object_list">
                <h2 class="header">Results<span class="calendar_link">{% if page.has_previous %}<a href="?q={{ literal_query }}{% if current_facet.0 %}&refine={{ current_facet.0 }}:{{ current_facet.1 }}{% endif %}{% if date_exact %}&date={{ date_exact }}{% endif %}&page={{ page.previous_page_number }}">&laquo; Previous</a> &bull; {% endif %}{{ page.start_index }} &ndash; {{ page.end_index }} of {{ paginator.count }}{% if page.has_next %} &bull; <a href="?q={{ literal_query }}{% if current_facet.0 %}&refine={{ current_facet.0 }}:{{ current_facet.1 }}{% endif %}{% if date_exact %}&date={{ date_exact }}{% endif %}&page={{ page.next_page_number }}">Next &raquo;</a>{% endif %}</span></h2>
                {% for result in page.object_list %}
                    <div class="{% if not forloop.first %}search_result {% endif %}item">
                        {{ result.rendered|safe }}
                    </div>
                {% empty %}
                    <p>No results found.</p>
                {% endfor %}
       	    </div>
            <div class="page_navigation">
                {% if page.has_previous %}<a href="?q={{ literal_query }}{% if current_facet.0 %}&refine={{ current_facet.0 }}:{{ current_facet.1 }}{% endif %}{% if date_exact %}&date={{ date_exact }}{% endif %}&page={{ page.previous_page_number }}">&laquo; Previous</a> |{% endif %} Page {{ page.number }} of {{ page.paginator.num_pages }} {% if page.has_next %}| <a href="?q={{ literal_query }}{% if current_facet.0 %}&refine={{ current_facet.0 }}:{{ current_facet.1 }}{% endif %}{% if date_exact %}&date={{ date_exact }}{% endif %}&page={{ page.next_page_number }}">Next &raquo;</a>{% endif %}
            </div>
        {% else %}   
            {# Show some example queries to run, maybe query syntax, something else? #}
        {% endif %}
        <div id="ad" class="grid_9">
            {% render_banner_ad 'banner' %}
        </div>
    </div>
    <div id="sidebar" class="grid_3 omega">
        {% if query %}
            <h2 class="sectiongrey">Narrow your results</h2>
            <div>
                <dl>
                    <h2>Date published</h2>
                    <h3{% ifequal date_exact 'today' %} class="selected"{% endifequal %}><a href="?q={{ literal_query }}{% if current_facet.0 %}&refine={{ current_facet.0 }}:{{ current_facet.1 }}{% endif %}&date=today">Today</a></h3>
                    <h3{% ifequal date_exact 'past_week' %} class="selected"{% endifequal %}><a href="?q={{ literal_query }}{% if current_facet.0 %}&refine={{ current_facet.0 }}:{{ current_facet.1 }}{% endif %}&date=past_week">Past week</a></h3>
                    <h3{% ifequal date_exact 'past_month' %} class="selected"{% endifequal %}><a href="?q={{ literal_query }}{% if current_facet.0 %}&refine={{ current_facet.0 }}:{{ current_facet.1 }}{% endif %}&date=past_month">Past month</a></h3>
                    <h3{% if not date_exact %} class="selected"{% endif %}{% ifequal date_exact 'past_six_months' %} class="selected"{% endifequal %}><a href="?q={{ literal_query }}{% if current_facet.0 %}&refine={{ current_facet.0 }}:{{ current_facet.1 }}{% endif %}&date=past_six_months">Past six months</a></h3>
                    <h3{% ifequal date_exact 'past_year' %} class="selected"{% endifequal %}><a href="?q={{ literal_query }}{% if current_facet.0 %}&refine={{ current_facet.0 }}:{{ current_facet.1 }}{% endif %}&date=past_year">Past year</a></h3>
                    <h3{% ifequal date_exact 'any' %} class="selected"{% endifequal %}><a href="?q={{ literal_query }}{% if current_facet.0 %}&refine={{ current_facet.0 }}:{{ current_facet.1 }}{% endif %}&date=any">Any date</a></h3>
                </dl>
            </div>
            <div>
                <dl>
                    {% if facets.fields.section_exact %}
                        <h2>Section</h2>
                            <h3{% ifnotequal current_facet.0 'section' %} class="selected"{% endifnotequal %}><a href="?q={{ literal_query }}{% if date_exact %}&date={{ date_exact }}{% endif %}">All sections</a></h3>
                        {% for section in facets.fields.section_exact %}
                            <h3{% ifequal current_facet.0 'section' %}{% ifequal current_facet.1 section.0|slugify %} class="selected"{% endifequal %}{% endifequal %}><a href="?q={{ literal_query }}&amp;refine=section:{{ section.0|slugify }}{% if date_exact %}&date={{ date_exact }}{% endif %}">{{ section.0 }}</a> ({{ section.1 }})</h3>
                        {% endfor %}
                    {% endif %}
                </dl>
            </div>
            <div>
                <dl>
                    {% if facets.fields.authors %}
                        <h2>Authors</h2>
                            <h3{% ifnotequal current_facet.0 'authors' %} class="selected"{% endifnotequal %}><a href="?q={{ literal_query }}{% if date_exact %}&date={{ date_exact }}{% endif %}">All authors</a></h3>
                        {% for author in facets.fields.authors|slice:"5" %}
                            <h3{% ifequal current_facet.0 'authors' %}{% ifequal current_facet.1 author.0 %} class="selected"{% endifequal %}{% endifequal %}><a href="?q={{ literal_query }}&amp;refine=authors:{{ author.0|urlencode }}{% if date_exact %}&date={{ date_exact }}{% endif %}">{{ author.0 }}</a> ({{ author.1 }})</h3>
                        {% endfor %}
                        {% if facets.fields.authors.5 %}
                            <a href="#" id="more_authors">View more authors...</a>
                            <div id="more_author_options">
                            {% for author in facets.fields.authors|slice:"5:" %}
                                <h3{% ifequal current_facet.0 'authors' %}{% ifequal current_facet.1 author.0 %} class="selected"{% endifequal %}{% endifequal %}><a href="?q={{ literal_query }}&amp;refine=authors:{{ author.0|urlencode }}{% if date_exact %}&date={{ date_exact }}{% endif %}">{{ author.0 }}</a> ({{ author.1 }})</h3>
                            {% endfor %}
                            <a href="#" id="collapse_authors">Collapse author list...</a>
                            </div>
                        {% endif %}
                    {% endif %}
                </dl>
            </div>
        {% endif %}
        {% comment %}{% render_banner_ad 'vertical' %}{% endcomment %}
    </div>
    </form>
{% endblock content_wide %}
